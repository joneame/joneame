var geo_map=null;var geocoder=null;var geo_ermua=new GLatLng(43.186642,-2.502607);var geo_last_point;var geo_last_address;function geo_get_marker(a,b){var c=new GIcon();c.iconSize=new GSize(20,25);c.iconAnchor=new GPoint(10,25);c.infoWindowAnchor=new GPoint(10,12);switch(b){case"geo":case"geo_edit":c.image=base_url+"img/geo/geo.png";break;case"queued":c.image=base_url+"img/geo/nueva-noticia.png";break;case"published":c.image=base_url+"img/geo/publicada.png";break;case"comment":c.image=base_url+"img/geo/comentario.png";break;case"post":c.image=base_url+"img/geo/nueva-notita.png";break;case"user":default:c.image=base_url+"img/geo/usuario.png";break}return new GMarker(a,c)}function geo_basic_load(d,a,b){var c;if(GBrowserIsCompatible()&&(c=document.getElementById("map"))){geo_map=new GMap2(c);b=b||7;if(d||a){point=new GLatLng(d,a);geo_map.setCenter(point,b)}else{geo_map.setCenter(geo_ermua,b)}return true}return false}function geo_coder_load(d,a,c,b){if(geo_basic_load(d,a,c)){geo_map.addControl(new GSmallZoomControl());if(d||a){point=new GLatLng(d,a);geo_map.addOverlay(geo_get_marker(point,b))}return true}return false}function geo_coder_editor_load(d,a,c,b){if(geo_coder_load(d,a,c,b)){geo_add_click_listener(b)}}function geo_add_click_listener(a){GEvent.addListener(geo_map,"click",function(c,b){if(c){return}geo_last_point=b;geo_last_address=b.toString().replace(/[\(\)]/g,"");geo_map.clearOverlays();geo_map.addOverlay(geo_get_marker(b,a));document.geocoderform.geosave.disabled=false;document.geocoderform.address.value=geo_last_address})}function geo_show_address(b){if(!geocoder){geocoder=new GClientGeocoder();geocoder.setBaseCountryCode("ES")}if(geocoder&&document.geocoderform.address.value){var a=document.geocoderform.address.value;if(a.match(/^ *-*[0-9\.]+, *-*[0-9\.]+ *$/)){coords=a.split(/[, ]+/);geo_found_point(new GLatLng(coords[0],coords[1]),b)}else{geocoder.getLatLng(a,function(c){if(!c){geo_last_point=false;geo_last_address=false;document.geocoderform.geosave.disabled=true;alert('"'+a+'" not found')}else{geo_found_point(c,b)}})}}return false}function geo_found_point(a,b){geo_map.clearOverlays();geo_last_point=a;geo_last_address=document.geocoderform.address.value;geo_map.panTo(a);geo_map.addOverlay(geo_get_marker(a,b));document.geocoderform.geosave.disabled=false}function geo_save_current(b,c){if(geo_last_point&&geo_last_address){var a=base_url+"geo/save.php?type="+b+"&id="+c+"&lat="+geo_last_point.lat()+"&lng="+geo_last_point.lng()+"&text="+encodeURIComponent(geo_last_address);$.ajax({url:a,dataType:"html",success:function(d){if(/^ERROR:/.test(d)){alert(d)}else{geo_map.setCenter(geo_last_point);document.geocoderform.geodelete.disabled=false;document.geocoderform.geosave.disabled=true}}})}else{alert("No address to save")}}function geo_delete(b,c){var a=base_url+"geo/delete.php?type="+b+"&id="+c;$.ajax({url:a,dataType:"html",success:function(d){document.geocoderform.geodelete.disabled=true;if(/^ERROR:/.test(d)){alert(d)}else{geo_map.clearOverlays();geo_map.setCenter(geo_ermua,7)}}})}function geo_load_xml(a,c,b){GDownloadUrl(base_url+"geo/xml.php?type="+a+"&status="+c,function(k,j){var g=[];var f=GXml.parse(k);var l=f.documentElement.getElementsByTagName("marker");for(var h=0;h<l.length;h++){var d=new GLatLng(parseFloat(l[h].getAttribute("lat")),parseFloat(l[h].getAttribute("lng")));var e=l[h].getAttribute("status");marker=geo_get_marker(d,e);marker.myId=parseInt(l[h].getAttribute("id"));marker.myType=a;g.push(marker)}geo_marker_mgr.addMarkers(g,b);geo_marker_mgr.refresh()})};