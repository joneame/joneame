(function(a){a.fn.ajaxSubmit=function(b){if(typeof b=="function"){b={success:b}}b=a.extend({url:this.attr("action")||window.location.toString(),type:this.attr("method")||"GET"},b||{});var o={};this.trigger("form-pre-serialize",[this,b,o]);if(o.veto){return this}var i=this.formToArray(b.semantic);if(b.data){b.extraData=b.data;for(var d in b.data){i.push({name:d,value:b.data[d]})}}if(b.beforeSubmit&&b.beforeSubmit(i,this,b)===false){return this}this.trigger("form-submit-validate",[i,this,b,o]);if(o.veto){return this}var c=a.param(i);if(b.type.toUpperCase()=="GET"){b.url+=(b.url.indexOf("?")>=0?"&":"?")+c;b.data=null}else{b.data=c}var m=this,f=[];if(b.resetForm){f.push(function(){m.resetForm()})}if(b.clearForm){f.push(function(){m.clearForm()})}if(!b.dataType&&b.target){var l=b.success||function(){};f.push(function(j){a(b.target).html(j).each(l,arguments)})}else{if(b.success){f.push(b.success)}}b.success=function(p,n){for(var q=0,j=f.length;q<j;q++){f[q](p,n,m)}};var h=a("input:file",this).fieldValue();var g=false;for(var e=0;e<h.length;e++){if(h[e]){g=true}}if(b.iframe||g){if(a.browser.safari&&b.closeKeepAlive){a.get(b.closeKeepAlive,k)}else{k()}}else{a.ajax(b)}this.trigger("form-submit-notify",[this,b]);return this;function k(){var A=m[0];var y=a.extend({},a.ajaxSettings,b);var x="jqFormIO"+(new Date().getTime());var w=a('<iframe id="'+x+'" name="'+x+'" />');var v=w[0];var t=a.browser.opera&&window.opera.version()<9;if(a.browser.msie||t){v.src='javascript:false;document.write("");'}w.css({position:"absolute",top:"-1000px",left:"-1000px"});var s={responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){}};var B=y.global;if(B&&!a.active++){a.event.trigger("ajaxStart")}if(B){a.event.trigger("ajaxSend",[s,y])}var r=0;var n=0;setTimeout(function(){var q=m.attr("target"),p=m.attr("action");m.attr({target:x,encoding:"multipart/form-data",enctype:"multipart/form-data",method:"POST",action:y.url});if(y.timeout){setTimeout(function(){n=true;u()},y.timeout)}var j=[];try{if(b.extraData){for(var C in b.extraData){j.push(a('<input type="hidden" name="'+C+'" value="'+b.extraData[C]+'" />').appendTo(A)[0])}}w.appendTo("body");v.attachEvent?v.attachEvent("onload",u):v.addEventListener("load",u,false);A.submit()}finally{m.attr("action",p);q?m.attr("target",q):m.removeAttr("target");a(j).remove()}},10);function u(){if(r++){return}v.detachEvent?v.detachEvent("onload",u):v.removeEventListener("load",u,false);var D=true;try{if(n){throw"timeout"}var C,q;q=v.contentWindow?v.contentWindow.document:v.contentDocument?v.contentDocument:v.document;s.responseText=q.body?q.body.innerHTML:null;s.responseXML=q.XMLDocument?q.XMLDocument:q;s.getResponseHeader=function(F){var E={"content-type":y.dataType};return E[F]};if(y.dataType=="json"||y.dataType=="script"){var j=q.getElementsByTagName("textarea")[0];s.responseText=j?j.value:s.responseText}else{if(y.dataType=="xml"&&!s.responseXML&&s.responseText!=null){s.responseXML=z(s.responseText)}}C=a.httpData(s,y.dataType)}catch(p){D=false;a.handleError(y,s,"error",p)}if(D){y.success(C,"success");if(B){a.event.trigger("ajaxSuccess",[s,y])}}if(B){a.event.trigger("ajaxComplete",[s,y])}if(B&&!--a.active){a.event.trigger("ajaxStop")}if(y.complete){y.complete(s,D?"success":"error")}setTimeout(function(){w.remove();s.responseXML=null},100)}function z(p,j){if(window.ActiveXObject){j=new ActiveXObject("Microsoft.XMLDOM");j.async="false";j.loadXML(p)}else{j=(new DOMParser()).parseFromString(p,"text/xml")}return(j&&j.documentElement&&j.documentElement.tagName!="parsererror")?j:null}}};a.fn.ajaxForm=function(b){return this.ajaxFormUnbind().bind("submit.form-plugin",function(){a(this).ajaxSubmit(b);return false}).each(function(){a(":submit,input:image",this).bind("click.form-plugin",function(f){var d=this.form;d.clk=this;if(this.type=="image"){if(f.offsetX!=undefined){d.clk_x=f.offsetX;d.clk_y=f.offsetY}else{if(typeof a.fn.offset=="function"){var c=a(this).offset();d.clk_x=f.pageX-c.left;d.clk_y=f.pageY-c.top}else{d.clk_x=f.pageX-this.offsetLeft;d.clk_y=f.pageY-this.offsetTop}}}setTimeout(function(){d.clk=d.clk_x=d.clk_y=null},10)})})};a.fn.ajaxFormUnbind=function(){this.unbind("submit.form-plugin");return this.each(function(){a(":submit,input:image",this).unbind("click.form-plugin")})};a.fn.formToArray=function(t){var w=[];if(this.length==0){return w}var s=this[0];var r=t?s.getElementsByTagName("*"):s.elements;if(!r){return w}for(var m=0,u=r.length;m<u;m++){var q=r[m];var k=q.name;if(!k){continue}if(t&&s.clk&&q.type=="image"){if(!q.disabled&&s.clk==q){w.push({name:k+".x",value:s.clk_x},{name:k+".y",value:s.clk_y})}continue}var x=a.fieldValue(q,true);if(x&&x.constructor==Array){for(var l=0,h=x.length;l<h;l++){w.push({name:k,value:x[l]})}}else{if(x!==null&&typeof x!="undefined"){w.push({name:k,value:x})}}}if(!t&&s.clk){var p=s.getElementsByTagName("input");for(var m=0,u=p.length;m<u;m++){var o=p[m];var k=o.name;if(k&&!o.disabled&&o.type=="image"&&s.clk==o){w.push({name:k+".x",value:s.clk_x},{name:k+".y",value:s.clk_y})}}}return w};a.fn.formSerialize=function(b){return a.param(this.formToArray(b))};a.fn.fieldSerialize=function(c){var d=[];this.each(function(){var g=this.name;if(!g){return}var e=a.fieldValue(this,c);if(e&&e.constructor==Array){for(var f=0,b=e.length;f<b;f++){d.push({name:g,value:e[f]})}}else{if(e!==null&&typeof e!="undefined"){d.push({name:this.name,value:e})}}});return a.param(d)};a.fn.fieldValue=function(f){for(var e=[],h=0,d=this.length;h<d;h++){var j=this[h];var g=a.fieldValue(j,f);if(g===null||typeof g=="undefined"||(g.constructor==Array&&!g.length)){continue}g.constructor==Array?a.merge(e,g):e.push(g)}return e};a.fieldValue=function(r,q){var j=r.name,w=r.type,x=r.tagName.toLowerCase();if(typeof q=="undefined"){q=true}if(q&&(!j||r.disabled||w=="reset"||w=="button"||(w=="checkbox"||w=="radio")&&!r.checked||(w=="submit"||w=="image")&&r.form&&r.form.clk!=r||x=="select"&&r.selectedIndex==-1)){return null}if(x=="select"){var p=r.selectedIndex;if(p<0){return null}var s=[],h=r.options;var o=(w=="select-one");var m=(o?p+1:h.length);for(var k=(o?p:0);k<m;k++){var l=h[k];if(l.selected){var u=a.browser.msie&&!(l.attributes.value.specified)?l.text:l.value;if(o){return u}s.push(u)}}return s}return r.value};a.fn.clearForm=function(){return this.each(function(){a("input,select,textarea",this).clearFields()})};a.fn.clearFields=a.fn.clearInputs=function(){return this.each(function(){var c=this.type,b=this.tagName.toLowerCase();if(c=="text"||c=="password"||b=="textarea"){this.value=""}else{if(c=="checkbox"||c=="radio"){this.checked=false}else{if(b=="select"){this.selectedIndex=-1}}}})};a.fn.resetForm=function(){return this.each(function(){if(typeof this.reset=="function"||(typeof this.reset=="object"&&!this.reset.nodeType)){this.reset()}})};a.fn.enable=function(c){if(c==undefined){c=true}return this.each(function(){this.disabled=!c})};a.fn.select=function(c){if(c==undefined){c=true}return this.each(function(){var d=this.type;if(d=="checkbox"||d=="radio"){this.checked=c}else{if(this.tagName.toLowerCase()=="option"){var b=a(this).parent("select");if(c&&b[0]&&b[0].type=="select-one"){b.find("option").select(false)}this.selected=c}}})}})(jQuery);