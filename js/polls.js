function update_votes_counter(c){var b=$("#votos-e-"+c).html();var a=$("#usuarios-totales-"+c).html();b++;a++;$("#votos-e-"+c).html(b);$("#usuarios-totales-"+c).html(a)}function update_comments_counter(b){var a=$("#opiniones-"+b).html();a++;$("#opiniones-"+b).html(a)}function ajax_poll_vote(e){var b=new XMLHttpRequest();var a=document.getElementById("cuenta_"+e).value;var c=new Array();var d=new Array();for(i=0;i<a;i++){c[i]=document.getElementById("opcion_"+e+"["+i+"]").checked}for(i=0;i<a;i++){if(c[i]==true){d[i]=document.getElementById("opcion_"+e+"["+i+"]").value}else{d[i]=0}}if(b){b.onreadystatechange=function(){if(b.readyState==4){var f=b.responseText;document.getElementById("pollvotes"+e).innerHTML=String(f);update_votes_counter(e);return true}};b.open("POST","/ajax/poll_vote.php",true);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.send("poll_id="+e+"&opciones="+d)}}function setOpacity(a){obj=document.getElementById("ajaxcomments");container=document.getElementById("ajaxcontainer");obj.style.filter="alpha(opacity:"+a+")";obj.style.KHTMLOpacity=a/100;obj.style.MozOpacity=a/100;obj.style.opacity=a/100;container.style.height=(a*obj.offsetHeight/100)+10+"px"}function fadeIn(a){if(a<=100){setOpacity(a);a+=50;window.setTimeout("fadeIn("+a+")",25)}}function startFade(){setOpacity(document.getElementById("ajaxcomments"),0);document.getElementById("ajaxcomments").style.visibility="visible";fadeIn(0)}function submit_comment(){if(document.getElementById("poll_content").value==""){document.getElementById("error_com").innerHTML="Comentario vacío";document.getElementById("spinner").className="ko";document.getElementById("poll_content").focus();return false}var b=document.getElementById("poll_content").value;var e=document.getElementById("process").value;var d=document.getElementById("poll_id").value;var a=document.getElementById("user_id").value;var c=new XMLHttpRequest();if(c){document.getElementById("submit_com").disabled=true;document.getElementById("poll_content").disabled=true;document.getElementById("spinner").className="loading";c.onreadystatechange=function(){if(c.readyState==4){var f=c.responseText;if(String(f).substring(0,3)=="OK:"){document.getElementById("spinner").className="ok";document.getElementById("poll_content").value="";document.getElementById("ajaxcomments").innerHTML=String(f).substring(3);startFade();update_comments_counter(id);return true}else{document.getElementById("spinner").className="ko";document.getElementById("submit_com").disabled=false;document.getElementById("plol_content").disabled=false;document.getElementById("error_com").innerHTML=String(f).substring(3);return false}}};c.open("POST","/ajax/poll_com.php",true);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send("poll_content="+encodeURIComponent(b)+"&process="+e+"&poll_id="+d+"&user_id="+a)}}function edit_comment(c){if(document.getElementById("comment_"+c).value==""){document.getElementById("error_com_"+c).innerHTML="Comentario vacío";document.getElementById("spinner_"+c).className="spinner ko";document.getElementById("comment_"+c).focus();return false}var b=document.getElementById("comment_"+c).value;var e=document.getElementById("poll_id_"+c).value;var a=document.getElementById("user_id_"+c).value;var d=new XMLHttpRequest();if(d){document.getElementById("submit_com_"+c).disabled=true;document.getElementById("comment_"+c).disabled=true;document.getElementById("spinner_"+c).className="spinner loading";d.onreadystatechange=function(){if(d.readyState==4){var g=d.responseText;if(String(g).substring(0,3)=="OK:"){document.getElementById("spinner_"+c).className="spinner ok";document.getElementById("comment_"+c).value="";document.getElementById("ccontainer-"+c).innerHTML=String(g).substring(3);return true}else{document.getElementById("spinner_"+c).className="spinner ko";document.getElementById("submit_com_"+c).disabled=false;document.getElementById("comment_"+c).disabled=false;document.getElementById("error_com_"+c).innerHTML=String(g).substring(3);return false}}};d.open("POST","/ajax/edit_poll_comment.php?id="+c,true);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.send("id="+c+"&poll_content="+encodeURIComponent(b)+"&process=editcomment&poll_id="+e+"&user_id="+a);var f=d.responseText}}function edit_poll(h){var e=new XMLHttpRequest();var f=document.getElementById("process-"+h).value;if(f=="save_settings"){var d=document.getElementById("cuenta"+h).value;var b=document.getElementById("titulo").value;var a=document.getElementById("descripcion").value;var g=new Array();var c=new Array();for(i=0;i<d;i++){c[i]=document.getElementById("opcion"+i).value}for(i in c){g[i]=document.getElementById("valor"+i).value}}if(e){e.onreadystatechange=function(){if(e.readyState==4){var j=e.responseText;document.getElementById("editbox-"+h).innerHTML=String(j);if(f=="save_settings"){save_options(h,g,f,b,a)}return true}};e.open("POST","/ajax/polls_utils.php",true);e.setRequestHeader("Content-Type","application/x-www-form-urlencoded");e.send("poll_id="+h+"&process="+f)}}function save_options(f,e,d,b,a){var c=new XMLHttpRequest();if(c){c.onreadystatechange=function(){if(c.readyState==4){var g=c.responseText;document.getElementById("pollvotes"+f).innerHTML=String(g);return true}};c.open("POST","/ajax/polls_utils.php",true);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send("poll_id="+f+"&process="+d+"&opciones="+e+"&titulo="+b+"&descripcion="+a)}}function delete_poll(b){var a=new XMLHttpRequest();if(a){a.onreadystatechange=function(){if(a.readyState==4){var c=a.responseText;document.getElementById("encuesta"+b).innerHTML="";return true}};a.open("POST","/ajax/poll_delete.php",true);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send("poll_id="+b)}}function add_option(){var e=document.getElementsByTagName("dt");var c=e.length;var b=document.getElementById("encuesta-opciones");var d=document.createElement("dt");var a=document.createElement("dd");if(c==15){alert("Has superado el número de opciones máximas");return true}previous=parseInt(c)-1;eliminar=document.getElementById("delete-"+previous);padre3=eliminar.parentNode;padre3.removeChild(eliminar);original=c;d.id="opcion-"+original;siguiente=parseInt(original)+parseInt(1);d.innerHTML="opción "+siguiente;a.id="opcion-t-"+original;a.innerHTML='<input type="text" value="" size="70" name="opts['+original+']" id="opts['+original+']"> <span id="delete-'+original+'"> <a href="javascript:delete_option('+original+')"> <img class="icon delete" alt="eliminar opción" title="eliminar opción"></a></span>';b.appendChild(d);b.appendChild(a)}function delete_option(a){previous=parseInt(a)-1;opcion=document.getElementById("opcion-"+a);cuadro=document.getElementById("opcion-t-"+a);contenido=document.getElementById("opts["+previous+"]").value;padre=opcion.parentNode;padre.removeChild(opcion);padre2=cuadro.parentNode;padre2.removeChild(cuadro);dd=document.getElementById("opcion-t-"+previous);dd.innerHTML='<input type="text" value="'+contenido+'" size="70" name="opts['+previous+']" id="opts['+previous+']"><span id="delete-'+previous+'"><a href="javascript:delete_option('+previous+')" > <img class="icon delete" alt="eliminar opción" title="eliminar opción"></a></span>'};